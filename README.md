🛡️ اسکریپت رفع نشت DNS (Anti DNS Leak)
این اسکریپت setdns.sh برای بهینه‌سازی و رفع مشکل DNS Leak در سرورهای لینوکس مبتنی بر دبیان/اوبونتو (مانند اوبونتو 20.04 به بالا) طراحی شده است. هدف اصلی این اسکریپت، پیکربندی امن سرویس‌های DNS سیستم به گونه‌ای است که تنها از DNSهای سریع و محلی مرتبط با موقعیت جغرافیایی سرور شما استفاده شود. این کار به صورت کامل از نشت اطلاعات DNS به بیرون جلوگیری کرده و امنیت و حریم خصوصی را به میزان قابل توجهی افزایش می‌دهد.

🎯 ویژگی‌ها و کاربردها
✅ بهینه‌سازی کامل سیستم: به‌روزرسانی پکیج‌ها و سیستم عامل با جلوگیری از درخواست‌های needrestart به صورت خودکار.
✅ تشخیص هوشمند موقعیت: با استفاده از سرویس‌های قابل اطمینان (مانند ipapi.co)، کشور سرور را تشخیص داده و لیست ۵ DNS عمومی و پاسخگو را برای آن منطقه پیدا و تست می‌کند.
✅ پیکربندی امن با Cloudflared: سرویس cloudflared به عنوان یک پراکسی امن DNS-over-HTTPS (DoH) نصب و به درستی پیکربندی می‌شود. تمامی درخواست‌های DNS سیستم از طریق این پراکسی محلی هدایت می‌شوند.
✅ جلوگیری کامل از نشتی DNS: با استفاده از cloudflared و تنظیم دقیق systemd-resolved، تمام ترافیک DNS به صورت امن و محلی پردازش می‌شود.
✅ تصحیح خطای متداول Hostname: خطای sudo: unable to resolve host را با شناسایی خودکار hostname و به‌روزرسانی فایل /etc/hosts برطرف می‌کند.
✅ بررسی نهایی خودکار: در پایان اجرای اسکریپت، یک تست داخلی DNS انجام می‌شود و نتیجه آن در ترمینال نمایش داده می‌شود تا از صحت عملکرد و عدم نشت DNS مطمئن شوید.

⚠️ نکته مهم
این اسکریپت DNSها را بر اساس موقعیت فعلی سرور شما پیکربندی می‌کند. اگر سرور به کشور یا موقعیت جغرافیایی دیگری منتقل شود، باید اسکریپت را مجدداً اجرا کنید تا DNSهای جدید مرتبط با مکان سرور شناسایی و تنظیم شوند. استفاده از DNSهای یک کشور دیگر می‌تواند باعث لو رفتن موقعیت مکانی شما در تست‌های نشت DNS شود.

⚙️ پیش‌نیازها
سیستم عامل: اوبونتو 20.04 و بالاتر یا هر سیستم مبتنی بر دبیان ( Debian-based distributions)

دسترسی: sudo یا root

اتصال به اینترنت

پکیج curl: باید از قبل روی سیستم نصب باشد.

🚀 نحوه دانلود و اجرا
برای بهره‌برداری از این اسکریپت، یکی از روش‌های زیر را دنبال کنید:

۱. اجرای مستقیم با مجوز (پیشنهادی)
این روش ساده‌ترین راه برای اجرای اسکریپت است. با استفاده از دستور زیر، اسکریپت به صورت مستقیم از گیت‌هاب دانلود شده و با دسترسی‌های لازم اجرا می‌شود:

bash <(curl -fsSL -H 'Cache-Control: no-cache' https://raw.githubusercontent.com/BigPyth0n/Fix-DNS-Leak-With-GPT/main/setdns.sh)

۲. اجرای دستی (گام به گام)
اگر ترجیح می‌دهید اسکریپت را به صورت دستی دانلود کرده و اجرا کنید، مراحل زیر را دنبال کنید:

دریافت فایل اسکریپت بدون کش:

curl -H 'Cache-Control: no-cache' -L https://raw.githubusercontent.com/BigPyth0n/Fix-DNS-Leak-With-GPT/main/setdns.sh -o setdns.sh

دادن دسترسی اجرا به فایل:

chmod +x setdns.sh

اجرای اسکریپت با دسترسی sudo:

sudo ./setdns.sh

🧪 تست نهایی
پس از اتمام موفقیت‌آمیز اجرای اسکریپت، یک تست خودکار نشت DNS انجام شده و خلاصه‌ای از نتیجه در ترمینال نمایش داده می‌شود. برای اطمینان کامل و بررسی جامع‌تر، توصیه می‌شود به صورت دستی نیز نتیجه را در وب‌سایت‌های زیر بررسی کنید:

DNSLeakTest:
https://www.dnsleaktest.com → گزینه Extended Test را انتخاب کنید.

IP/DNS/Browser Leak Test:
https://browserleaks.com/dns

در این تست‌ها، فقط باید آی‌پی مربوط به سرور شما یا آی‌پی‌های مربوط به Cloudflare (که پراکسی DNS امن شماست) مشاهده شوند و هیچ DNS دیگری از کشورهای مختلف نباید نمایش داده شود.

📁 آدرس GitHub
مشاهده فایل در GitHub

لینک مستقیم اسکریپت (Raw)
